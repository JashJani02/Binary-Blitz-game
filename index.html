<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Blitz Game</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d121c; /* Almost black */
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: #1a2230; /* Darker than body */
            border-radius: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 3rem;
            width: 100%;
            max-width: 900px;
            border: 2px solid #2d3748;
            position: relative;
        }

        /* Styling for the main action buttons */
        .panel-btn {
            @apply px-6 py-3 rounded-2xl font-bold transition duration-300 transform hover:scale-105 shadow-lg;
            background-color: #2d3748;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
            border: 2px solid #3b4251;
        }

        .input-field {
            @apply p-4 w-full rounded-2xl bg-gray-200 text-gray-900 border-2 border-gray-600 focus:outline-none focus:ring-4 focus:ring-blue-500 transition duration-200;
            font-family: 'Roboto Mono', monospace;
        }
        
        .bit-btn {
            @apply w-1/8 p-4 md:p-6 rounded-2xl font-bold text-4xl transition duration-200 transform hover:scale-105;
            background-color: #3b4251;
            color: #94a3b8;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 2px solid #4a5568;
        }
        
        .bit-btn.active {
            @apply bg-green-500 text-white;
            box-shadow: 0 0 15px rgba(76, 209, 55, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.3);
            border-color: #4ade80;
        }

        .bit-label {
            font-family: 'Roboto Mono', monospace;
        }

        .modal {
            @apply fixed inset-0 bg-gray-900 bg-opacity-80 flex justify-center items-center z-50 transition-opacity duration-300 ease-out;
            opacity: 0;
            visibility: hidden;
        }

        .modal.is-active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            @apply bg-gray-800 p-10 rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300 ease-out;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            border: 2px solid #3b4251;
        }

        .modal.is-active .modal-content {
            transform: scale(1);
        }
        
        #score-panel, #timer-panel {
            min-width: 100px;
            text-align: center;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            background-color: #2d3748;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
        }

        .feedback-message {
            opacity: 0;
            transform: translateY(10px);
            animation: fade-in-up 0.5s forwards;
        }

        @keyframes fade-in-up {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .correct-animation {
            animation: pulse-green 0.6s ease-out;
        }

        .incorrect-animation {
            animation: shake-red 0.6s ease-out;
        }

        @keyframes pulse-green {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(76, 209, 55, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(76, 209, 55, 0); }
            100% { transform: scale(1); }
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        /* --- New Button Styles --- */
        .glass-btn {
            @apply relative overflow-hidden text-gray-200;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease-in-out;
            will-change: transform;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
        }
        
        .glass-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .glass-btn:hover::before {
            left: 100%;
        }

        .game-action-btn {
            @apply glass-btn px-6 py-3 rounded-2xl font-bold text-lg;
            border-radius: 9999px; /* Pill shape */
        }

        /* New game over modal styles */
        .game-over-title {
            font-size: 4rem; /* 64px */
            font-weight: 800;
            color: #e2e8f0;
            text-shadow: 0 0 20px #4ade80, 0 0 40px #4ade80, 0 0 60px #4ade80;
            animation: glow-text 1.5s ease-in-out infinite alternate;
        }

        .game-over-subtitle {
            font-size: 1.5rem; /* 24px */
            color: #94a3b8;
            margin-top: -1rem;
        }

        @keyframes glow-text {
            0% { text-shadow: 0 0 10px #4ade80, 0 0 20px #4ade80; }
            100% { text-shadow: 0 0 20px #4ade80, 0 0 40px #4ade80, 0 0 60px #4ade80; }
        }

        .new-high-score-message {
            @apply text-yellow-400 font-bold text-2xl animate-bounce;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <!-- Audio elements for sound effects -->
    <audio id="correct-audio" src="https://assets.mixkit.co/sfx/preview/mixkit-game-success-319.mp3"></audio>
    <audio id="incorrect-audio" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-1606.mp3"></audio>
    <audio id="game-over-audio" src="https://assets.mixkit.co/sfx/preview/mixkit-game-over-1944.mp3"></audio>

    <div class="container mx-auto text-center">
        <h1 class="text-6xl font-extrabold text-blue-400 mb-4">Binary Blitz</h1>
        <p class="text-xl text-gray-400 mb-8">Click the bits to match the decimal number!</p>

        <!-- Main Game Area -->
        <div id="game-area">
            <div class="flex flex-col md:flex-row justify-around items-center mb-10 space-y-4 md:space-y-0">
                <div id="score-panel" class="text-2xl font-bold text-green-400">Score: <span id="score">0</span></div>
                <div id="timer-panel" class="text-2xl font-bold text-red-400">Time: <span id="timer">20</span>s</div>
                <div id="level-panel" class="text-2xl font-bold text-yellow-400">Level: <span id="level">1</span></div>
            </div>

            <div class="bg-gray-800 p-8 rounded-3xl my-8 text-center shadow-2xl transition duration-500 ease-in-out" id="question-card">
                <p id="question-display" class="text-6xl md:text-7xl font-mono font-bold text-white mb-6 animate-pulse">0</p>
                
                <div class="flex justify-between items-center mb-4 text-xs md:text-sm font-mono text-gray-400" id="bit-labels">
                    <!-- Bit labels will be inserted here by JS -->
                </div>
                
                <div class="grid grid-cols-8 gap-2 md:gap-4" id="bit-buttons">
                    <!-- Bit buttons will be inserted here by JS -->
                </div>
                
                <p id="binary-display" class="text-2xl md:text-3xl font-mono mt-6 text-gray-300">
                    <span id="binary-value">00000000</span>
                </p>
                <p id="sum-display" class="text-xl md:text-2xl font-mono mt-2 text-blue-400">Current Sum: 0</p>
            </div>

            <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                <button id="start-btn" class="game-action-btn">Start Game</button>
                <button id="submit-btn" class="game-action-btn opacity-50 cursor-not-allowed" disabled>Submit</button>
                <button id="instructions-btn" class="game-action-btn">Instructions</button>
            </div>

            <p id="feedback" class="text-center text-xl mt-6 font-semibold feedback-message"></p>
        </div>

        <!-- High Scores Section -->
        <div class="mt-12 bg-gray-800 p-8 rounded-3xl shadow-2xl border-2 border-gray-700">
            <h2 class="text-4xl font-bold text-center text-blue-400 mb-6">High Scores</h2>
            <div class="relative overflow-x-auto rounded-lg">
                <table id="high-scores-table" class="w-full text-left text-gray-300">
                    <thead class="text-sm text-gray-200 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-3">Rank</th>
                            <th scope="col" class="px-6 py-3">Name</th>
                            <th scope="col" class="px-6 py-3">Score</th>
                        </tr>
                    </thead>
                    <tbody id="high-scores-body" class="divide-y divide-gray-700">
                        <!-- High scores will be inserted here by JS -->
                    </tbody>
                </table>
            </div>
            <p class="text-sm text-gray-500 text-center mt-4">Scores are saved to your browser's local storage.</p>
        </div>
        
        <!-- Instructions Modal -->
        <div id="instructions-modal" class="modal">
            <div class="modal-content text-left">
                <button id="close-instructions-btn" class="absolute top-4 right-6 text-gray-400 hover:text-gray-200 text-4xl font-bold">&times;</button>
                <h3 class="text-4xl font-bold text-white mb-4">How to Play</h3>
                <p class="text-gray-300 mb-4">
                    The goal of Binary Blitz is to quickly convert decimal numbers to their 8-bit binary equivalent.
                    You will be given a decimal number (0-255). Below it are a series of buttons, representing the powers of 2.
                    Click the buttons to toggle them on or off. The sum of the "on" bits will be displayed.
                    When your sum matches the target number, click "Submit" to score a point and move to the next level.
                    You have 20 seconds for each question.
                </p>
                <h4 class="text-2xl font-bold text-gray-200 mb-2">The Bits (Powers of 2)</h4>
                <div class="flex justify-between items-center mb-4 text-sm font-mono text-gray-400">
                    <span class="w-1/8 text-center">128</span>
                    <span class="w-1/8 text-center">64</span>
                    <span class="w-1/8 text-center">32</span>
                    <span class="w-1/8 text-center">16</span>
                    <span class="w-1/8 text-center">8</span>
                    <span class="w-1/8 text-center">4</span>
                    <span class="w-1/8 text-center">2</span>
                    <span class="w-1/8 text-center">1</span>
                </div>
                <p class="text-gray-300">
                    As you progress through the levels, the powers of 2 labels will disappear, forcing you to memorize their positions.
                    This game is a great tool for anyone preparing for networking certifications like the CCNA.
                </p>
            </div>
        </div>

        <!-- End Game Modal -->
        <div id="end-game-modal" class="modal">
            <div class="modal-content text-center">
                <h3 class="game-over-title font-extrabold mb-2">GAME OVER</h3>
                <p class="game-over-subtitle font-bold text-lg text-gray-400">That was a great game!</p>
                <p id="final-score" class="text-3xl font-semibold text-white mb-4 mt-6">Your final score: 0</p>
                <p id="levels-completed" class="text-xl font-semibold text-gray-300 mb-4"></p>
                <div id="high-score-form" class="hidden">
                    <p class="new-high-score-message mb-2">New High Score! 🎉</p>
                    <p class="text-lg font-semibold text-gray-300 mb-2">Enter your name:</p>
                    <input type="text" id="player-name-input" class="input-field mb-4 text-black placeholder-black" placeholder="Your name...">
                    <button id="save-score-btn" class="game-action-btn">Save Score</button>
                </div>
                <button id="play-again-btn" class="game-action-btn mt-4">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let level = 1;
        let timer = 20; // 20 seconds per question
        let timerInterval;
        let currentDecimal = 0;
        const bits = [128, 64, 32, 16, 8, 4, 2, 1];
        let activeBits = Array(8).fill(false);

        // DOM Elements
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const timerEl = document.getElementById('timer');
        const questionEl = document.getElementById('question-display');
        const binaryDisplayEl = document.getElementById('binary-display');
        const sumDisplayEl = document.getElementById('sum-display');
        const bitLabelsContainer = document.getElementById('bit-labels');
        const bitButtonsContainer = document.getElementById('bit-buttons');
        const feedbackEl = document.getElementById('feedback');
        const startBtn = document.getElementById('start-btn');
        const submitBtn = document.getElementById('submit-btn');
        const instructionsBtn = document.getElementById('instructions-btn');
        const instructionsModal = document.getElementById('instructions-modal');
        const closeInstructionsBtn = document.getElementById('close-instructions-btn');
        const endGameModal = document.getElementById('end-game-modal');
        const finalScoreEl = document.getElementById('final-score');
        const levelsCompletedEl = document.getElementById('levels-completed');
        const highScoreForm = document.getElementById('high-score-form');
        const playerNameInput = document.getElementById('player-name-input');
        const saveScoreBtn = document.getElementById('save-score-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const highScoresBody = document.getElementById('high-scores-body');
        const questionCard = document.getElementById('question-card');

        // Audio Elements
        const correctAudio = document.getElementById('correct-audio');
        const incorrectAudio = document.getElementById('incorrect-audio');
        const gameOverAudio = document.getElementById('game-over-audio');
        
        // Event Listeners
        startBtn.addEventListener('click', startGame);
        submitBtn.addEventListener('click', checkAnswer);
        instructionsBtn.addEventListener('click', () => instructionsModal.classList.add('is-active'));
        closeInstructionsBtn.addEventListener('click', () => instructionsModal.classList.remove('is-active'));
        saveScoreBtn.addEventListener('click', saveScore);
        playAgainBtn.addEventListener('click', () => {
            endGameModal.classList.remove('is-active');
            startGame();
        });

        // Functions
        function createBitButtons() {
            bitLabelsContainer.innerHTML = '';
            bitButtonsContainer.innerHTML = '';
            bits.forEach((value, index) => {
                const label = document.createElement('span');
                label.className = `w-1/8 text-center bit-label transition-opacity duration-500 ${level > 3 ? 'opacity-0' : ''}`;
                label.textContent = value;
                bitLabelsContainer.appendChild(label);

                const button = document.createElement('button');
                button.className = `bit-btn font-mono text-3xl md:text-4xl`;
                button.dataset.value = value;
                button.dataset.index = index;
                button.textContent = '0';
                button.addEventListener('click', toggleBit);
                bitButtonsContainer.appendChild(button);
            });
        }

        function toggleBit(event) {
            const button = event.target;
            const index = button.dataset.index;
            const bitValue = parseInt(button.dataset.value);
            
            activeBits[index] = !activeBits[index];
            button.classList.toggle('active', activeBits[index]);
            button.textContent = activeBits[index] ? '1' : '0';

            updateSum();
        }

        function updateSum() {
            const sum = activeBits.reduce((total, isEnabled, index) => {
                return total + (isEnabled ? bits[index] : 0);
            }, 0);
            sumDisplayEl.textContent = `Current Sum: ${sum}`;
            binaryDisplayEl.textContent = ``;
            for(let i=0; i<8; i++){
                binaryDisplayEl.textContent += activeBits[i] ? '1' : '0';
            }
        }
        
        function startGame() {
            score = 0;
            level = 1;
            scoreEl.textContent = score;
            levelEl.textContent = level;
            feedbackEl.textContent = '';
            
            // Enable/disable buttons
            submitBtn.disabled = false;
            startBtn.disabled = true;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
            highScoreForm.classList.add('hidden');
            
            createBitButtons();
            generateQuestion();
        }

        function endGame() {
            clearInterval(timerInterval);
            submitBtn.disabled = true;
            startBtn.disabled = false;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
            finalScoreEl.textContent = `Your final score: ${score}`;
            levelsCompletedEl.textContent = `Levels completed: ${level - 1}`;
            endGameModal.classList.add('is-active');
            gameOverAudio.play();

            const highScores = getHighScores();
            const isHighScore = highScores.length < 10 || score > highScores[highScores.length - 1].score;
            if (isHighScore) {
                highScoreForm.classList.remove('hidden');
            }
        }

        function generateQuestion() {
            // Reset timer for new question
            clearInterval(timerInterval);
            timer = 20;
            timerEl.textContent = timer;
            timerInterval = setInterval(() => {
                timer--;
                timerEl.textContent = timer;
                if (timer <= 0) {
                    endGame();
                }
            }, 1000);

            // Clear previous state
            activeBits.fill(false);
            const bitButtons = document.querySelectorAll('.bit-btn');
            bitButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.textContent = '0';
            });
            updateSum();
            questionCard.classList.remove('correct-animation', 'incorrect-animation', 'shake-red', 'pulse-green');
            feedbackEl.classList.remove('feedback-message');
            feedbackEl.textContent = '';
            
            currentDecimal = Math.floor(Math.random() * 256); // 0-255 range for 8-bit
            questionEl.textContent = currentDecimal;

            // Hide bit labels after level 3, as in the Cisco game
            const bitLabels = document.querySelectorAll('.bit-label');
            bitLabels.forEach(label => {
                label.style.opacity = (level > 3) ? '0' : '1';
            });
        }

        function checkAnswer() {
            const sum = activeBits.reduce((total, isEnabled, index) => {
                return total + (isEnabled ? bits[index] : 0);
            }, 0);
            
            if (sum === currentDecimal) {
                score += (level * timer); // Score increases with level and remaining time
                level++;
                scoreEl.textContent = score;
                levelEl.textContent = level;
                feedbackEl.textContent = 'Correct! ✨';
                feedbackEl.style.color = '#4ade80';
                feedbackEl.classList.add('feedback-message');
                questionCard.classList.add('correct-animation');
                correctAudio.play();
                
                setTimeout(generateQuestion, 600);

            } else {
                feedbackEl.textContent = `Incorrect. Try again!`;
                feedbackEl.style.color = '#f87171';
                feedbackEl.classList.add('feedback-message');
                questionCard.classList.add('incorrect-animation');
                incorrectAudio.play();
            }
        }
        
        // High Score Management
        function getHighScores() {
            const scores = localStorage.getItem('highScores');
            return scores ? JSON.parse(scores) : [];
        }

        function saveHighScores(scores) {
            localStorage.setItem('highScores', JSON.stringify(scores));
        }

        function displayHighScores() {
            const highScores = getHighScores().sort((a, b) => b.score - a.score);
            highScoresBody.innerHTML = '';
            highScores.forEach((entry, index) => {
                const row = document.createElement('tr');
                const rowClass = (index % 2 === 0) ? 'bg-gray-800' : 'bg-gray-900';
                row.classList.add(rowClass, 'border-b', 'border-gray-700', 'hover:bg-gray-700', 'transition', 'duration-200');
                row.innerHTML = `
                    <td class="px-6 py-4 font-bold text-lg">${index + 1}</td>
                    <td class="px-6 py-4 font-semibold">${entry.name}</td>
                    <td class="px-6 py-4 font-semibold">${entry.score}</td>
                `;
                highScoresBody.appendChild(row);
            });
        }

        function saveScore() {
            const playerName = playerNameInput.value.trim();
            if (playerName === '') {
                playerNameInput.placeholder = 'Please enter your name!';
                return;
            }

            const highScores = getHighScores();
            highScores.push({ name: playerName, score: score });
            highScores.sort((a, b) => b.score - a.score);
            if (highScores.length > 10) {
                highScores.pop(); // Keep only the top 10 scores
            }
            saveHighScores(highScores);
            displayHighScores();
            endGameModal.classList.remove('is-active');
            highScoreForm.classList.add('hidden');
        }

        // Initial setup
        displayHighScores();
    </script>
</body>
</html>
